<!DOCTYPE html>
<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <base href="/" />
    <title>Callback to Omnis</title>
</head>

<body>
    <div>
        <p>Callback:</p>
        <input id="myCallback" type="text" style="display: block; width:100%" disabled/>
        <button id="myButton">Call</button>
    </div>


    <script>
        var Global = {};
        Global.baseDir = document.location.protocol + "//" + document.location.host + document.location.pathname;

        if (Global.baseDir.substring(Global.baseDir.length - 4) == ".htm") {
            Global.baseDir = Global.baseDir.substring(0, Global.baseDir.lastIndexOf("/"));
        }
        if (Global.baseDir.substring(Global.baseDir.length - 1) != "/") {
            Global.baseDir = Global.baseDir + "/";
        }

        var base = document.getElementsByTagName("base");
        base[0].href = Global.baseDir;
    </script>


    <script src="./omn_list_base.js" charset="utf-8"></script>
    <script src="./omnishtmlcontrol.js" charset="utf-8"></script>
    <script type="text/javascript">
        // Auxiliary method to wrap the jOmnis.sendControlEvent
        var __sendControlEvent = function (evType, data, callback) {
            console.log("Sending event", evType, data, callback);
            var message = {
                evType: evType
            };
            if (data !== undefined) {
                message.data = (typeof (data) === "string") ? data : JSON.stringify(data);
            }
            if (callback !== undefined) {
                message.callback = callback;
            }
            jOmnis.sendControlEvent(message);
        };


        var inputText;
        var myButton;
        var callbackData = null;
        var omnisCallback = "";
        console.log("Script loaded!");
        
      

        jOmnis.callbackObject = {
            omnisOnLoad: function () {
                console.log("OMNIS: onLoad");
                inputText = document.getElementById("myCallback");
            myButton = document.getElementById("myButton");
            myButton.addEventListener('click', function () {
                console.log("CLICK!", callbackData, omnisCallback);
                if (callbackData && omnisCallback !== "") {
                    __sendControlEvent('evCallFromOBrowser', {
                        callData1: "SomeTestData " + new Date().getTime(),
                        callbackArgs: callbackData
                    }, omnisCallback);
                }
            });
            },

            setCallBack: function (params) {
                // Called from Omnis to set the Omnis callback method and some arguments
                console.log("OI", "setCallback", arguments);
                callbackData = params.callbackArgs; // Arguments from Omnis, in this case it's a simple string, but it could be a JSON-encoded object
                omnisCallback = params.omnisCallback; // Full omnis notation to the callbacl

                inputText.value = omnisCallback;
            }
        };

    </script>



</body>

</html>